{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h3>ğŸ“Š Placares dos Jogos</h3>
  
  {% if current_user.is_admin() %}
  <!-- FormulÃ¡rio para registrar/editar placar -->
  <div class='card p-3 mb-4 shadow-sm'>
    <h5 class="mb-3">âš½ Registrar Resultado do Jogo</h5>
    <form method='post' action='/salvar-placar' class='row g-3'>
      <div class='col-md-3'>
        <label class="form-label">Jogo</label>
        <select name='jogo_id' class='form-select' required>
          <option value=''>Selecione o jogo...</option>
          {% for jogo in jogos %}
          <option value='{{ jogo.id }}' {% if jogo_selecionado and jogo_selecionado == jogo.id %}selected{% endif %}>
            {{ jogo.data.strftime('%d/%m/%Y') }} - {{ jogo.adversario or 'AdversÃ¡rio' }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class='col-md-2'>
        <label class="form-label">Placar AssociaÃ§Ã£o</label>
        <input type='number' name='placar_associacao' min='0' class='form-control' required>
      </div>
      <div class='col-md-2'>
        <label class="form-label">Placar AdversÃ¡rio</label>
        <input type='number' name='placar_adversario' min='0' class='form-control' required>
      </div>
      <div class='col-md-3'>
        <label class="form-label">Status</label>
        <select name='status' class='form-select' required>
          <option value='realizado'>âœ… Realizado</option>
          <option value='cancelado'>âŒ Cancelado</option>
          <option value='adiado'>â° Adiado</option>
        </select>
      </div>
      <div class='col-md-2 d-flex align-items-end'>
        <button type='submit' class='btn btn-success w-100'>ğŸ“ Salvar</button>
      </div>
    </form>
  </div>
  {% else %}
  <div class="alert alert-warning">
    <strong>Acesso Restrito:</strong> Apenas administradores podem registrar placares.
  </div>
  {% endif %}

  <!-- Lista de jogos com resultados -->
  <div class='card shadow-sm'>
    <div class='card-body'>
      <h5 class='card-title mb-3'>ğŸ“‹ HistÃ³rico de Jogos</h5>
      <div class='table-responsive'>
        <table class='table table-hover'>
          <thead class='table-dark'>
            <tr>
              <th>Data</th>
              <th>AdversÃ¡rio</th>
              <th>Placar</th>
              <th>Status</th>
              <th>Resultado</th>
              <th>AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody>
            {% for jogo in jogos %}
            <tr>
              <td>{{ jogo.data.strftime('%d/%m/%Y') }}</td>
              <td>{{ jogo.adversario or '-' }}</td>
              <td>
                {% if jogo.resumo_texto %}
                  <strong>{{ jogo.resumo_texto }}</strong>
                {% else %}
                  <em class="text-muted">NÃ£o registrado</em>
                {% endif %}
              </td>
              <td>
                {% if 'realizado' in jogo.resumo_texto %}
                  <span class="badge bg-success">âœ… Realizado</span>
                {% elif 'cancelado' in jogo.resumo_texto %}
                  <span class="badge bg-danger">âŒ Cancelado</span>
                {% elif 'adiado' in jogo.resumo_texto %}
                  <span class="badge bg-warning">â° Adiado</span>
                {% else %}
                  <span class="badge bg-secondary">ğŸ“… Agendado</span>
                {% endif %}
              </td>
              <td>
                {% if jogo.resumo_texto and 'x' in jogo.resumo_texto %}
                  {% set placar_parts = jogo.resumo_texto.split('x') %}
                  {% if placar_parts|length == 2 %}
                    {% set assoc_gols = placar_parts[0].strip()|int %}
                    {% set adv_gols = placar_parts[1].split()[0].strip()|int %}
                    {% if assoc_gols > adv_gols %}
                      <span class="badge bg-success">ğŸ† VitÃ³ria</span>
                    {% elif assoc_gols < adv_gols %}
                      <span class="badge bg-danger">ğŸ˜ Derrota</span>
                    {% else %}
                      <span class="badge bg-warning">ğŸ¤ Empate</span>
                    {% endif %}
                  {% endif %}
                {% else %}
                  <em class="text-muted">-</em>
                {% endif %}
              </td>
              <td>
                {% if current_user.is_admin() %}
                  <a href='/placares/{{ jogo.id }}' class='btn btn-sm btn-outline-primary'>
                    {% if jogo.resumo_texto %}âœï¸ Editar{% else %}ğŸ“ Registrar{% endif %}
                  </a>
                {% else %}
                  <span class="text-muted">-</span>
                {% endif %}
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="6" class="text-center text-muted">
                <em>Nenhum jogo cadastrado</em>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- EstatÃ­sticas -->
  {% if estatisticas %}
  <div class='row mt-4'>
    <div class='col-md-3'>
      <div class='card border-success'>
        <div class='card-body text-center'>
          <h6 class='card-title'>ğŸ† VitÃ³rias</h6>
          <h4 class='text-success'>{{ estatisticas.vitorias }}</h4>
        </div>
      </div>
    </div>
    <div class='col-md-3'>
      <div class='card border-danger'>
        <div class='card-body text-center'>
          <h6 class='card-title'>ğŸ˜ Derrotas</h6>
          <h4 class='text-danger'>{{ estatisticas.derrotas }}</h4>
        </div>
      </div>
    </div>
    <div class='col-md-3'>
      <div class='card border-warning'>
        <div class='card-body text-center'>
          <h6 class='card-title'>ğŸ¤ Empates</h6>
          <h4 class='text-warning'>{{ estatisticas.empates }}</h4>
        </div>
      </div>
    </div>
    <div class='col-md-3'>
      <div class='card border-info'>
        <div class='card-body text-center'>
          <h6 class='card-title'>ğŸ“Š Aproveitamento</h6>
          <h4 class='text-info'>{{ "%.1f"|format(estatisticas.aproveitamento) }}%</h4>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
