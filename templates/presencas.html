{% extends "base.html" %}
{% block content %}

<h4>ğŸ“‹ PresenÃ§as e Pagamentos: {{ jogo.adversario }} ({{ jogo.data.strftime('%d/%m/%Y') }})</h4>

<!-- Resumo da Partida -->
<div class='card p-2 p-md-3 mb-4 shadow-sm'>
  <div class='row g-2'>
    <div class='col-6 col-md-3'>
      <div class='card border-primary'>
        <div class='card-body text-center p-2'>
          <h6 class='card-title small'>ğŸ‘¥ Confirmados</h6>
          <p class='card-text mb-0'>
            <strong class='text-primary'>{{ total_confirmados }}</strong>
            <br>
            <small class='text-muted'>jogadores</small>
          </p>
        </div>
      </div>
    </div>
    <div class='col-6 col-md-3'>
      <div class='card border-success'>
        <div class='card-body text-center p-2'>
          <h6 class='card-title small'>ğŸ’° Arrecadado</h6>
          <p class='card-text mb-0'>
            <strong class='text-success'>R$ {{ "%.2f"|format(total_arrecadado) }}</strong>
            <br>
            <small class='text-muted'>total</small>
          </p>
        </div>
      </div>
    </div>
    <div class='col-6 col-md-3'>
      <div class='card border-danger'>
        <div class='card-body text-center p-2'>
          <h6 class='card-title small'>ğŸ’¸ Despesas</h6>
          <p class='card-text mb-0'>
            <strong class='text-danger'>R$ {{ "%.2f"|format(total_despesas) }}</strong>
            <br>
            <small class='text-muted'>despesas</small>
          </p>
        </div>
      </div>
    </div>
    <div class='col-6 col-md-3'>
      <div class='card border-info'>
        <div class='card-body text-center p-2'>
          <h6 class='card-title small'>ğŸ’µ Saldo</h6>
          <p class='card-text mb-0'>
            <strong class='text-info'>R$ {{ "%.2f"|format(total_arrecadado - total_despesas) }}</strong>
            <br>
            <small class='text-muted'>saldo</small>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â• Adicionar Jogador ao Jogo -->
{% if current_user.is_admin() %}
<form method='post' class="mb-3">
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="mb-3">â• Adicionar Jogador ao Jogo</h5>

      <div class="row g-2 align-items-end">
        <div class="col-md-9">
          <select name="novo_jogador_id" id="novo_jogador" class="form-control">
            <option value="">Buscar jogador...</option>
            {% for jogador in todos_jogadores %}
              {% if jogador.id not in jogadores_no_jogo %}
                <option value="{{ jogador.id }}">{{ jogador.nome }} ({{ jogador.tipo }})</option>
              {% endif %}
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3 d-grid">
          <button type="submit" name="acao" value="add_jogador" class="btn btn-success">
            Adicionar
          </button>
        </div>
      </div>
    </div>
  </div>
</form>
{% else %}
<!-- BotÃ£o para sÃ³cio se adicionar ao jogo -->
{% if current_user.jogador and current_user.jogador.tipo == 'SOCIO' %}
  {% set meu_id = current_user.jogador_id %}
  {% set ja_adicionado = false %}
  {% for p in participacoes %}
    {% if p.jogador_id == meu_id %}
      {% set ja_adicionado = true %}
    {% endif %}
  {% endfor %}
  
  {% if not ja_adicionado %}
  <form method='post' class="mb-3">
    <div class="card shadow-sm border-success">
      <div class="card-body">
        <h5 class="mb-3">ğŸ¯ Participar do Jogo</h5>
        <p class="mb-3">Deseja se adicionar a este jogo?</p>
        <div class="d-grid">
          <button type="submit" name="acao" value="add_jogador" class="btn btn-success btn-lg">
            âœ… Confirmar PresenÃ§a
          </button>
        </div>
      </div>
    </div>
  </form>
  {% else %}
  <div class="card shadow-sm border-info mb-3">
    <div class="card-body">
      <h5 class="mb-3">âœ… VocÃª jÃ¡ estÃ¡ neste jogo!</h5>
      <p class="mb-0">Sua participaÃ§Ã£o jÃ¡ estÃ¡ confirmada. VocÃª pode confirmar presenÃ§a na tabela abaixo.</p>
    </div>
  </div>
  {% endif %}
{% endif %}
{% endif %}

<!-- ================= VERSÃƒO MOBILE (CARDS) ================= -->
<div class='d-md-none mb-3'>
  <form method='post' id='mobile-form'>
  {% for p in participacoes_existentes.values() %}
  <div class='card shadow-sm mb-2'>
    <div class='card-body p-3'>
      <!-- CabeÃ§alho do Jogador -->
      <div class='d-flex justify-content-between align-items-start mb-3'>
        <div>
          <h6 class='mb-1'>{{ p.jogador.nome }}</h6>
          <small class='text-muted'>{{ p.jogador.tipo }}</small>
          {% if p.jogador.nativo %}
          <span class='badge bg-info ms-1'>ğŸ  Nativo</span>
          {% endif %}
        </div>
        <div>
          {% if p.pagou %}
            <span class='badge bg-success'>âœ… Pago</span>
          {% else %}
            <span class='badge bg-warning'>â³ NÃ£o pago</span>
          {% endif %}
        </div>
      </div>

      <!-- Campos do FormulÃ¡rio -->
      <div class='row g-2'>
        <div class='col-6'>
          <label class='form-label small'>Presente</label>
          {% if current_user.is_admin() %}
          <div class='form-check'>
            <input class='form-check-input' type='checkbox' name='confirmou_{{ p.id }}' {% if p.confirmou %}checked{% endif %}>
            <label class='form-check-label'>Confirmou</label>
          </div>
          {% elif current_user.jogador_id == p.jogador.id %}
          <div class='form-check'>
            <input class='form-check-input' type='checkbox' name='confirmou_{{ p.id }}' {% if p.confirmou %}checked{% endif %}>
            <label class='form-check-label'>Confirmar presenÃ§a</label>
          </div>
          {% else %}
          <div class='form-text'>
            {% if p.confirmou %}âœ… Confirmou{% else %}âŒ NÃ£o confirmou{% endif %}
          </div>
          {% endif %}
        </div>

        <div class='col-6'>
          <label class='form-label small'>Pagou</label>
          {% if current_user.is_admin() %}
            {% set dias_jogo = (data_jogo_hoje - jogo.data).days %}
            <div class='form-check'>
              <input class='form-check-input' type='checkbox' name='pagou_{{ p.id }}' {% if p.pagou %}checked{% endif %} {% if dias_jogo > 15 %}disabled title="Jogos com mais de 15 dias nÃ£o permitem ediÃ§Ã£o de pagamentos"{% endif %}>
              <label class='form-check-label'>Pagou</label>
            </div>
          {% else %}
            <div class='form-text'>
              {% if p.pagou %}âœ… Pagou{% else %}âŒ NÃ£o pagou{% endif %}
            </div>
          {% endif %}
        </div>

        <div class='col-12'>
          <label class='form-label small'>Valor R$</label>
          {% if current_user.is_admin() %}
            {% set dias_jogo = (data_jogo_hoje - jogo.data).days %}
            <input type='number' step='0.01' min='0' name='valor_{{ p.id }}' 
                   value='{{ "%.2f"|format(p.valor_pago) }}' class='form-control form-control-sm'
                   {% if dias_jogo > 15 %}disabled title="Jogos com mais de 15 dias nÃ£o permitem ediÃ§Ã£o de valores"{% endif %}>
          {% else %}
            <div class='form-text'>R$ {{ "%.2f"|format(p.valor_pago) }}</div>
          {% endif %}
        </div>

        {% if current_user.is_admin() %}
        <div class='col-4'>
          <label class='form-label small'>âš½ Gols</label>
          <input type='number' min='0' name='gols_{{ p.id }}' 
                 value='{{ p.gols or 0 }}' class='form-control form-control-sm text-center'>
        </div>

        <div class='col-4'>
          <label class='form-label small'>ğŸŸ¥ Expulso</label>
          <div class='form-check'>
            <input class='form-check-input' type='checkbox' name='expulso_{{ p.id }}' {% if p.expulso %}checked{% endif %}>
          </div>
        </div>

        <div class='col-4'>
          <label class='form-label small'>â­ Craque</label>
          <div class='form-check'>
            <input class='form-check-input' type='radio' name='craque_id' value='{{ p.jogador.id }}' 
                   {% if jogo.craque_id == p.jogador.id %}checked{% endif %}>
          </div>
        </div>

        <div class='col-12'>
          <button type='submit' formaction="{{ url_for('remover_jogador_partida', jogo_id=jogo.id, jogador_id=p.jogador.id) }}" 
                  class='btn btn-sm btn-danger w-100'
                  {% if p.lancado_financeiro %}disabled title="NÃ£o pode remover - jÃ¡ lanÃ§ado financeiramente"{% endif %}
                  onclick='return confirm("Tem certeza que deseja remover {{ p.jogador.nome }} da partida?")'>
            ğŸ—‘ï¸ Remover
          </button>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
  {% else %}
  <div class='text-center text-muted py-4'>
    <em>Nenhum jogador adicionado Ã  partida ainda.</em>
  </div>
  {% endfor %}
  
  <!-- BotÃ£o de salvar para mobile -->
  <div class='d-grid'>
    <button type='submit' class='btn btn-primary btn-lg shadow mb-3'>ğŸ’¾ Salvar PresenÃ§as (Mobile)</button>
  </div>
  
  <!-- Despesas do Jogo - Mobile -->
  {% if current_user.is_admin() %}
  <div class='card shadow-sm bg-light mb-3'>
    <div class='card-header'>
      <h6 class='mb-0'>ğŸ’¸ Despesas do Jogo</h6>
    </div>
    <div class='card-body'>
      {% set dias_jogo = (data_jogo_hoje - jogo.data).days %}
      {% if dias_jogo > 15 %}
      <div class='alert alert-warning mb-3'>
        <small>
          <strong>âš ï¸ Jogo Bloqueado:</strong> Este jogo tem mais de 15 dias e nÃ£o permite ediÃ§Ã£o de valores.
        </small>
      </div>
      {% endif %}
      
      <!-- FormulÃ¡rio para adicionar despesa -->
      <form method='post' class='mb-3' {% if dias_jogo > 15 %}onsubmit="alert('Jogos com mais de 15 dias nÃ£o permitem adicionar despesas!'); return false;"{% endif %}>
        <div class='row g-2'>
          <div class='col-md-6'>
            <select name='desc_despesa' class='form-control' required {% if dias_jogo > 15 %}disabled{% endif %}>
              <option value=''>Selecione uma despesa...</option>
              <option value='Ãrbitro'>ğŸ‘¨â€âš–ï¸ Ãrbitro</option>
              <option value='Ãgua'>ğŸ’§ Ãgua</option>
              <option value='Bola'>âš½ Bola</option>
              <option value='Campo Aluguel'>ğŸŸï¸ Campo Aluguel</option>
              <option value='Uniformes'>ğŸ‘• Uniformes</option>
              <option value='Transporte'>ğŸš Transporte</option>
              <option value='Lanche'>ğŸ” Lanche</option>
              <option value='Material Esportivo'>ğŸ¥… Material Esportivo</option>
              <option value='Outros'>ğŸ“¦ Outros</option>
            </select>
          </div>
          <div class='col-md-3'>
            <input type='number' step='0.01' min='0' name='val_despesa' class='form-control' placeholder='Valor R$' required {% if dias_jogo > 15 %}disabled{% endif %}>
          </div>
          <div class='col-md-3'>
            <button type='submit' name='acao' value='add_despesa' class='btn btn-success w-100' {% if dias_jogo > 15 %}disabled{% endif %}>
              â• Adicionar Despesa
            </button>
          </div>
        </div>
      </form>
      
      {% for despesa in despesas_partida %}
      <div class='d-flex justify-content-between align-items-center mb-2 p-2 border-bottom'>
        <div>
          <strong>{{ despesa.descricao }}</strong>
          <br>
          <small class='text-muted'>{{ despesa.data.strftime('%d/%m/%Y') }}</small>
        </div>
        <div class='d-flex align-items-center'>
          <span class='text-danger me-2'>-R$ {{ "%.2f"|format(despesa.valor) }}</span>
          <form method="post" action="{{ url_for('extornar_despesa', despesa_id=despesa.id) }}" 
                onsubmit="return confirm('Tem certeza que deseja extornar esta despesa?');" 
                style="display: inline;">
            <button type="submit" class="btn btn-sm btn-danger">
              ğŸ—‘ï¸
            </button>
          </form>
        </div>
      </div>
      {% else %}
      <div class='text-center text-muted py-3'>
        <em>Nenhuma despesa registrada.</em>
      </div>
      {% endfor %}
      
      {% if despesas_partida %}
      <div class='alert alert-warning mt-3 mb-0'>
        <strong>Total de Despesas: R$ {{ "%.2f"|format(total_despesas) }}</strong>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}
  
  </form>
</div>

<!-- ================= VERSÃƒO DESKTOP (TABELA) ================= -->
<div class='d-none d-md-block'>
  <form method='post' id='desktop-form'>
  <div class='table-responsive shadow-sm bg-white mb-3'>
    <table class='table table-sm table-hover align-middle'>
      <thead class='table-secondary'>
        <tr>
          <th>Jogador</th>
          <th>Confirmou?</th>
          <th>Pagou?</th>
          <th>Valor R$</th>
          <th>âš½ Gols</th>
          <th>ğŸŸ¥ Expulso</th>
          <th>â­ Craque</th>
          <th>Status</th>
          <th>AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody>
        {% for p in participacoes_existentes.values() %}
        <tr>
          <td>
            <div class="d-flex flex-column">
              <strong>{{ p.jogador.nome }}</strong>
              <small class='text-muted'>{{ p.jogador.tipo }}</small>
              {% if p.jogador.nativo %}
              <span class="badge bg-info mt-1">ğŸ  Nativo</span>
              {% endif %}
            </div>
          </td>
          <td>
            {% if current_user.is_admin() %}
            <input type='checkbox' name='confirmou_{{ p.id }}' {% if p.confirmou %}checked{% endif %}>
            {% elif current_user.jogador_id == p.jogador.id %}
            <input type='checkbox' name='confirmou_{{ p.id }}' {% if p.confirmou %}checked{% endif %} title="Confirmar minha presenÃ§a">
            {% else %}
            {% if p.confirmou %}âœ…{% else %}âŒ{% endif %}
            {% endif %}
          </td>
          <td>
            {% if current_user.is_admin() %}
              {% set dias_jogo = (data_jogo_hoje - jogo.data).days %}
              <input type='checkbox' name='pagou_{{ p.id }}' {% if p.pagou %}checked{% endif %} {% if dias_jogo > 15 %}disabled title="Jogos com mais de 15 dias nÃ£o permitem ediÃ§Ã£o de pagamentos"{% endif %}>
            {% else %}
              {% if p.pagou %}âœ…{% else %}âŒ{% endif %}
            {% endif %}
          </td>
          <td>
            {% if current_user.is_admin() %}
              {% set dias_jogo = (data_jogo_hoje - jogo.data).days %}
              <input type='number' step='0.01' min='0' name='valor_{{ p.id }}' 
                     value='{{ "%.2f"|format(p.valor_pago) }}' class='form-control form-control-sm' 
                     {% if dias_jogo > 15 %}disabled title="Jogos com mais de 15 dias nÃ£o permitem ediÃ§Ã£o de valores"{% endif %}>
            {% else %}
              R$ {{ "%.2f"|format(p.valor_pago) }}
            {% endif %}
          </td>
          <td>
            {% if current_user.is_admin() %}
            <input type='number' min='0' name='gols_{{ p.id }}' 
                   value='{{ p.gols or 0 }}' class='form-control form-control-sm text-center'>
            {% else %}
            {{ p.gols or 0 }}
            {% endif %}
          </td>
          <td class="text-center">
            {% if current_user.is_admin() %}
            <input type='checkbox' name='expulso_{{ p.id }}' {% if p.expulso %}checked{% endif %}>
            {% else %}
            {% if p.expulso %}ğŸŸ¥{% else %}âœ…{% endif %}
            {% endif %}
          </td>
          <td class="text-center">
            {% if current_user.is_admin() %}
            <input type='radio' name='craque_id' value='{{ p.jogador.id }}' 
                   {% if jogo.craque_id == p.jogador.id %}checked{% endif %}>
            {% elif jogo.craque_id == p.jogador.id %}
            â­
            {% endif %}
          </td>
          <td>
            {% if p.pagou %}
              <span class="badge bg-success">âœ… Pago</span>
            {% else %}
              <span class="badge bg-warning">â³ NÃ£o pago</span>
            {% endif %}
          </td>
          <td>
            {% if current_user.is_admin() %}
            <form method="post" action="{{ url_for('remover_jogador_partida', jogo_id=jogo.id, jogador_id=p.jogador.id) }}" 
                  onsubmit="return confirm('Tem certeza que deseja remover {{ p.jogador.nome }} da partida?');" 
                  style="display: inline;">
              <button type="submit" class="btn btn-sm btn-danger" 
                      {% if p.lancado_financeiro %}disabled title="NÃ£o pode remover - jÃ¡ lanÃ§ado financeiramente"{% endif %}>
                ğŸ—‘ï¸
              </button>
            </form>
            {% endif %}
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="9" class="text-center text-muted">
            <em>Nenhum jogador adicionado Ã  partida ainda.</em>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Despesas do Jogo -->
  {% if current_user.is_admin() %}
  <div class='card shadow-sm bg-light mb-3'>
    <div class='card-header'>
      <h6 class='mb-0'>ğŸ’¸ Despesas do Jogo</h6>
    </div>
    <div class='card-body'>
      {% set dias_jogo = (data_jogo_hoje - jogo.data).days %}
      {% if dias_jogo > 15 %}
      <div class='alert alert-warning mb-3'>
        <small>
          <strong>âš ï¸ Jogo Bloqueado:</strong> Este jogo tem mais de 15 dias e nÃ£o permite ediÃ§Ã£o de valores (pagamentos e despesas).
        </small>
      </div>
      {% endif %}
      
      <!-- FormulÃ¡rio para adicionar despesa -->
      <form method='post' class='mb-3' {% if dias_jogo > 15 %}onsubmit="alert('Jogos com mais de 15 dias nÃ£o permitem adicionar despesas!'); return false;"{% endif %}>
        <div class='row g-2'>
          <div class='col-md-6'>
            <select name='desc_despesa' class='form-control' required {% if dias_jogo > 15 %}disabled{% endif %}>
              <option value=''>Selecione uma despesa...</option>
              <option value='Ãrbitro'>ğŸ‘¨â€âš–ï¸ Ãrbitro</option>
              <option value='Ãgua'>ğŸ’§ Ãgua</option>
              <option value='Bola'>âš½ Bola</option>
              <option value='Campo Aluguel'>ğŸŸï¸ Campo Aluguel</option>
              <option value='Uniformes'>ğŸ‘• Uniformes</option>
              <option value='Transporte'>ğŸš Transporte</option>
              <option value='Lanche'>ğŸ” Lanche</option>
              <option value='Material Esportivo'>ğŸ¥… Material Esportivo</option>
              <option value='Outros'>ğŸ“¦ Outros</option>
            </select>
          </div>
          <div class='col-md-3'>
            <input type='number' step='0.01' min='0' name='val_despesa' class='form-control' placeholder='Valor R$' required {% if dias_jogo > 15 %}disabled{% endif %}>
          </div>
          <div class='col-md-3'>
            <button type='submit' name='acao' value='add_despesa' class='btn btn-success w-100' {% if dias_jogo > 15 %}disabled{% endif %}>
              â• Adicionar Despesa
            </button>
          </div>
        </div>
      </form>
      
      <div class='table-responsive'>
        <table class='table table-sm'>
          <thead>
            <tr>
              <th>DescriÃ§Ã£o</th>
              <th>Valor</th>
              <th>Data</th>
              <th>AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody>
            {% for despesa in despesas_partida %}
            <tr>
              <td>{{ despesa.descricao }}</td>
              <td class='text-danger'>-R$ {{ "%.2f"|format(despesa.valor) }}</td>
              <td>{{ despesa.data.strftime('%d/%m/%Y') }}</td>
              <td>
              <form method="post" action="{{ url_for('extornar_despesa', despesa_id=despesa.id) }}" 
                    onsubmit="return confirm('Tem certeza que deseja extornar esta despesa?');" 
                    style="display: inline;">
                <button type="submit" class="btn btn-sm btn-danger">
                  ğŸ—‘ï¸
                </button>
              </form>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="4" class="text-center text-muted">
                <em>Nenhuma despesa registrada.</em>
              </td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot class='table-warning'>
          <tr>
            <th colspan="2">Total de Despesas</th>
            <th class="text-danger">
              <strong>R$ {{ "%.2f"|format(total_despesas) }}</strong>
            </th>
            <th colspan="1"></th>
          </tr>
        </tfoot>
      </table>
      </div>
      
      {% if despesas_partida %}
      <div class='alert alert-info mt-3 mb-0'>
        <small>
          <strong>Resumo Financeiro:</strong><br>
          â€¢ Total de Despesas: R$ {{ "%.2f"|format(total_despesas) }}<br>
          â€¢ NÂº de Despesas: {{ despesas_partida|length }}
        </small>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}
  
  <button class='btn btn-primary btn-lg shadow'>ğŸ’¾ Salvar PresenÃ§as (Desktop)</button>
  <a href='/pdf-partida/{{ jogo.id }}' class='btn btn-danger btn-lg'>
    ğŸ“„ Gerar PDF
  </a>
  <a href='/jogos' class='btn btn-secondary btn-lg'>Voltar</a>
  </form>
</div>

{% block scripts %}
<script>
// Validar formulÃ¡rio de adicionar despesa
document.addEventListener('DOMContentLoaded', function() {
  // Adicionar timestamp para evitar cache
  const timestamp = new Date().getTime();
  
  // Limpar cache dos formulÃ¡rios
  const forms = document.querySelectorAll('form[method="post"]');
  forms.forEach(form => {
    // Adicionar timestamp aos inputs para cache-busting
    const inputs = form.querySelectorAll('input, select, checkbox');
    inputs.forEach(input => {
      input.setAttribute('data-timestamp', timestamp);
    });
    
    // Verificar se Ã© formulÃ¡rio de adicionar despesa
    const acao = form.querySelector('input[name="acao"]');
    if (acao && acao.value === 'add_despesa') {
      console.log("FormulÃ¡rio de adicionar despesa detectado");
      
      form.addEventListener('submit', function(e) {
        console.log("=== ADICIONANDO DESPESA ===");
        
        const desc = form.querySelector('select[name="desc_despesa"]').value.trim();
        const val = form.querySelector('input[name="val_despesa"]').value.trim();
        
        if (!desc) {
          alert('Por favor, selecione uma despesa!');
          e.preventDefault();
          return false;
        }
        
        if (!val || parseFloat(val) <= 0) {
          alert('Por favor, informe um valor vÃ¡lido para a despesa!');
          e.preventDefault();
          return false;
        }
        
        console.log(`Despesa: ${desc} | Valor: R$ ${val}`);
        console.log("Enviando despesa para o servidor...");
      });
      
      return; // Pular validaÃ§Ã£o geral para formulÃ¡rios de despesa
    }
    
    // Pular formulÃ¡rios de extorno
    if (form.action && form.action.includes('extornar')) {
      console.log("Pulando formulÃ¡rio de extorno:", form.action);
      return;
    }
    
    // Adicionar validaÃ§Ã£o antes do envio - apenas para formulÃ¡rios principais
    form.addEventListener('submit', function(e) {
      console.log("=== FORMULÃRIO SENDO ENVIADO ===");
      console.log(`FormulÃ¡rio: ${form.id || 'sem ID'}`);
      console.log(`Action: ${form.action}`);
      
      // Coletar todos os dados antes do envio
      const formData = new FormData(form);
      console.log("Dados sendo enviados:");
      
      let hasData = false;
      for (let [key, value] of formData.entries()) {
        console.log(`  ${key}: ${value}`);
        hasData = true;
      }
      
      if (!hasData) {
        console.warn("ATENÃ‡ÃƒO: Nenhum dado encontrado no formulÃ¡rio!");
        alert("ATENÃ‡ÃƒO: O formulÃ¡rio nÃ£o contÃ©m dados para enviar!");
        e.preventDefault();
        return false;
      }
      
      // Verificar se hÃ¡ checkboxes marcados
      const checkedBoxes = form.querySelectorAll('input[type="checkbox"]:checked');
      console.log(`Checkboxes marcados: ${checkedBoxes.length}`);
      
      console.log("Enviando para o servidor...");
    });
  });
  
  // Log para debug
  console.log('FormulÃ¡rio de presenÃ§as atualizado em:', new Date().toLocaleString());
  
  // Detectar dispositivo
  const isMobile = window.innerWidth < 768;
  console.log('Dispositivo detectado:', isMobile ? 'Mobile' : 'Desktop');
});
</script>
{% endblock %}
{% endblock %}
