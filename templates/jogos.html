{% if current_user.is_admin() %}
<div class="card p-3 mb-4 shadow-sm">

  <form method="post" class="row g-2">

    <div class="col-12 col-md-2">
      <input type="date" name="data" class="form-control" required>
    </div>

    <div class="col-12 col-md-4">
      <input name="adversario" placeholder="Advers√°rio" class="form-control" required>
    </div>

    <div class="col-12 col-md-3">
      <div class="input-group">
        <input name="local" id="local-input" placeholder="Local" class="form-control">
        <button type="button" class="btn btn-outline-secondary"
                onclick="buscarLocalizacao()">üìç</button>
      </div>
    </div>

    <div class="col-12 col-md-2">
      <input type="number" step="0.01" min="0" name="valor_jogo"
             placeholder="Valor sugerido" class="form-control">
    </div>

    <div class="col-12 col-md-1 d-grid">
      <button class="btn btn-success">Cadastrar</button>
    </div>

  </form>

</div>
{% endif %}


<div class='table-responsive bg-white shadow-sm'>
  <table class='table table-hover mb-0'>
    <thead class='table-dark'>
      <tr>
        <th>Data</th>
        <th>Advers√°rio</th>
        <th>Local</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody>
      {% for jogo in jogos %}
      <tr>
        <td>{{ jogo.data.strftime('%d/%m/%Y') }}</td>
        <td>{{ jogo.adversario or '-' }}</td>
        <td>
          {% if jogo.local %}
            <a href='https://www.google.com/maps/search/{{ jogo.local|urlencode }}' target='_blank' class='text-decoration-none' title='Ver no Google Maps'>
              {{ jogo.local }} üìç
            </a>
          {% else %}
            -
          {% endif %}
        </td>
        <td>
          <a href='/presencas/{{ jogo.id }}' class='btn btn-sm btn-outline-primary'>Presen√ßas/Pagos</a>
          {% if current_user.is_admin() %}
            {% if not jogo.resumo_texto %}
              <a href='/teste-placar/{{ jogo.id }}' class='btn btn-sm btn-outline-success'>üìä Placar</a>
            {% endif %}
          {% endif %}
          <a href='/pdf-partida/{{ jogo.id }}' class='btn btn-sm btn-danger'>üìÑ PDF</a>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="4" class="text-center text-muted">Nenhum jogo cadastrado</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script>
function buscarLocalizacao() {
  const local = document.getElementById('local-input').value;
  if (local.trim()) {
    window.open(`https://www.google.com/maps/search/${encodeURIComponent(local)}`, '_blank');
  } else {
    alert('Digite um local para buscar no Google Maps');
  }
}

// Adicionar sugest√µes de autocomplete
document.getElementById('local-input').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    buscarLocalizacao();
  }
});
</script>
{% endblock %}
